<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Showcase</title>
    <base href="/wobble/">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸš€</text></svg>">
    <style>
        /* Optimize rendering */
        .letter, .typed-line-container, .tagline, .guidance, .welcome-footer-info p { 
            will-change: transform, opacity; 
            /* Start hidden via JS now, not CSS */
             opacity: 0; 
        } 
        .letter { display: inline-block; }
    </style>
</head>
<body>
    <div id="app">
        <aside id="sidebar">
            <header>
                <h1>My Projects</h1>
                <button id="theme-toggle" class="theme-button">
                    <svg class="sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.25a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0V3a.75.75 0 0 1 .75-.75ZM7.5 12a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM18.894 6.166a.75.75 0 0 0-1.06-1.06l-1.591 1.59a.75.75 0 1 0 1.06 1.061l1.591-1.59ZM21.75 12a.75.75 0 0 1-.75.75h-2.25a.75.75 0 0 1 0-1.5H21a.75.75 0 0 1 .75.75ZM17.834 18.894a.75.75 0 0 0 1.06-1.06l-1.59-1.591a.75.75 0 1 0-1.061 1.06l1.59 1.591ZM12 18a.75.75 0 0 1 .75.75V21a.75.75 0 0 1-1.5 0v-2.25A.75.75 0 0 1 12 18ZM7.758 17.303a.75.75 0 0 0-1.061-1.06l-1.591 1.59a.75.75 0 0 0 1.06 1.061l1.591-1.59ZM6 12a.75.75 0 0 1-.75.75H3a.75.75 0 0 1 0-1.5h2.25A.75.75 0 0 1 6 12ZM6.697 7.757a.75.75 0 0 0 1.06-1.06l-1.59-1.591a.75.75 0 0 0-1.061 1.06l1.59 1.591Z" /></svg>
                    <svg class="moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd" /></svg>
                </button>
                <button id="sidebar-toggle" class="sidebar-toggle-button" title="Collapse sidebar">
                    <svg class="icon-collapse" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
                    <svg class="icon-expand" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                </button>
            </header>
            <nav id="project-nav"></nav>
        </aside>
        <main id="content-area">
            <div id="tsparticles-bg"></div>
            <div id="welcome-screen"> 
                <div class="welcome-content">
                    <h1 class="main-headline">
                        <!-- Letters dynamically injected -->
                    </h1>
                    <p class="typed-line-container">
                        <span id="typed-line-element">A dynamic collection of projects.</span> 
                    </p>
                    <p class="tagline">Innovating with code, one project at a time.</p>
                    <div class="guidance" id="explore-hint" style="cursor: pointer;"> 
                        <span>Explore the Work</span>
                        <svg class="arrow-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M3 10a.75.75 0 01.75-.75h10.638L10.23 5.29a.75.75 0 111.04-1.08l5.5 5.25a.75.75 0 010 1.08l-5.5 5.25a.75.75 0 11-1.04-1.08l4.158-3.96H3.75A.75.75 0 013 10z" clip-rule="evenodd" />
                        </svg>
                    </div>
                </div>
                <div class="welcome-footer-info">
                    <p class="dev-hint">Site under development. Folders like <code>proj.*</code> and <code>cat.*</code> in <code>pages/</code> define content.</p>
                    <p class="contact-info">Contact: <a href="mailto:junovhs@gmail.com">junovhs@gmail.com</a></p>
                </div>
            </div>
            <iframe id="content-frame" title="Project Content" class="hidden"></iframe> 
        </main>
    </div>

    <script type="importmap">
    { "imports": { "marked": "https://cdn.jsdelivr.net/npm/marked@12.0.1/+esm" } }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/tsparticles-slim@2.12.0/tsparticles.slim.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <!-- <script src="https://unpkg.com/typed.js@2.1.0/dist/typed.umd.js"></script> -->

    <script type="module" src="config.js"></script>
    <script type="module" src="githubApi.js"></script>
    <script type="module" src="ui.js"></script>
    <script type="module" src="nav.js"></script>
    <script type="module" src="app.js"></script>

    <script>
        function runWelcomeAnimations() {
            console.log("[Animation Script V4] Attempting to run animations..."); 
            
            const welcomeScreen = document.getElementById('welcome-screen');
            if (!welcomeScreen || welcomeScreen.classList.contains('hidden')) {
                console.log("[Animation Script V4] Welcome screen not found or is hidden."); 
                return; 
            }

            // --- Target Elements ---
            const mainHeadlineEl = welcomeScreen.querySelector('.main-headline');
            const typedLineContainerEl = welcomeScreen.querySelector('.typed-line-container'); 
            const taglineEl = welcomeScreen.querySelector('.tagline');
            const guidanceEl = welcomeScreen.querySelector('.guidance');
            const arrowIconEl = welcomeScreen.querySelector('.guidance .arrow-icon');
            const devHintEl = welcomeScreen.querySelector('.dev-hint');
            const contactInfoEl = welcomeScreen.querySelector('.contact-info');
            const allAnimatedElements = [mainHeadlineEl, typedLineContainerEl, taglineEl, guidanceEl, arrowIconEl, devHintEl, contactInfoEl];

            // --- Check if elements exist ---
            if (allAnimatedElements.some(el => !el)) {
                 console.error("[Animation Script V4] One or more animation target elements not found! Aborting.", {
                     mainHeadlineEl, typedLineContainerEl, taglineEl, guidanceEl, arrowIconEl, devHintEl, contactInfoEl
                 });
                 // Make sure things are visible if animation fails
                 gsap.set(allAnimatedElements.filter(Boolean), { opacity: 1, y: 0, x: 0, scale: 1 });
                 return;
            }
            console.log("[Animation Script V4] Elements found, starting GSAP timeline setup...");

            // --- Prepare Headline Letters ---
            const headlineText = "Project Showcase"; 
            mainHeadlineEl.innerHTML = ''; 
            const letters = headlineText.split("").map(letter => {
                const span = document.createElement('span');
                span.textContent = letter === " " ? "\u00A0" : letter; // Use nbsp for spaces
                span.classList.add('letter');
                span.style.opacity = 0; // Set initial opacity directly for better control
                span.style.transform = 'translateY(40px)'; // Start translated down
                mainHeadlineEl.appendChild(span);
                return span;
            });
            
            // --- Kill Previous Animations ---
            gsap.killTweensOf([...allAnimatedElements, ...letters]);

            // --- Set Initial States Explicitly (Using GSAP for consistency) ---
            // Use gsap.set for instant application without animation
            gsap.set(letters, { y: 40, opacity: 0 }); 
            gsap.set([typedLineContainerEl, taglineEl, guidanceEl, arrowIconEl, devHintEl, contactInfoEl], { y: 25, opacity: 0 }); // Start others down and hidden
            gsap.set(mainHeadlineEl, { opacity: 1 }); // Ensure headline container is visible

            // --- Create GSAP Timeline ---
            const tl = gsap.timeline({ defaults: { ease: "power2.out", duration: 0.8, force3D: true } }); 

            // --- Define Animations (Using .to() exclusively) ---
            tl.addLabel("start", "+=0.2"); 

            // Headline letters fly in
            tl.to(letters, { 
                y: 0, 
                opacity: 1,
                stagger: 0.06,
                // duration: 0.8, // Default duration
                ease: "power3.out", // Slightly different ease for letters
              }, "start"); 

            // Secondary line fades/slides in (starts slightly before headline finishes)
            tl.to(typedLineContainerEl, { 
                y: 0, 
                opacity: 1 
            }, "-=0.5"); 

            // Tagline fades/slides in
            tl.to(taglineEl, { 
                y: 0, 
                opacity: 1, 
                duration: 0.7 // Slightly faster than default
            }, ">-0.3"); // Overlap slightly with previous

            // Guidance text and initial arrow fade-in
            tl.to(guidanceEl, { 
                y: 0, 
                opacity: 1, 
                duration: 0.6 
            }, "-=0.5");

            // Arrow pulse animation (starts after fade-in)
            tl.to(arrowIconEl, { // First fade in the arrow
                opacity: 0.7, 
                duration: 0.5 
            }, "<") 
              .to(arrowIconEl, { // Then pulse opacity
                  opacity: 1, 
                  scale: 1.1, // Subtle scale pulse
                  duration: 1.2, 
                  repeat: -1, 
                  yoyo: true, 
                  ease: "sine.inOut"
              }, ">-0.2");

            // Footer info - separate tween, starts after main timeline has progressed
            gsap.to([devHintEl, contactInfoEl], { 
                opacity: 1,
                y: 0,       
                duration: 1.0,
                delay: 1.5, // Fixed delay from start - simpler timing
                stagger: 0.2,
                ease: "power1.inOut",
                overwrite: "auto" 
            });
            console.log("[Animation Script V4] Animation setup complete."); 
        }

        // --- Explore Hint Click Handler --- (Moved outside runWelcomeAnimations) ---
         let highlightTimeout = null;
         function handleExploreHintClick() {
              console.log("[handleExploreHintClick] Explore Hint clicked!"); // ADDED LOG
              const appContainer = document.getElementById('app');
              if (appContainer) {
                    // Check if already highlighted to prevent rapid re-application
                    if (appContainer.classList.contains('highlight-sidebar')) {
                        return;
                    }
                    appContainer.classList.add('highlight-sidebar');
                    if (highlightTimeout) clearTimeout(highlightTimeout); 
                    highlightTimeout = setTimeout(() => {
                        appContainer.classList.remove('highlight-sidebar');
                        console.log("[handleExploreHintClick] Highlight removed."); // ADDED LOG
                    }, 1500); 
              } else {
                   console.warn("[handleExploreHintClick] #app container not found.");
              }
         }


        // --- DOM Ready Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            console.log("[DOM Ready V4] Page loaded."); 

            // Initialize Particles
            const isDarkMode = document.documentElement.getAttribute('data-theme') === 'dark';
             const particlesConfig = { /* Particle config remains the same */ 
                autoPlay: true, background: {}, fpsLimit: 60, interactivity: { events: { onHover: { enable: true, mode: "repulse" } }, modes: { repulse: { distance: 70, duration: 0.4, speed: 0.5 } }, }, particles: { color: { value: isDarkMode ? "#cccccc" : "#555555" }, links: { color: { value: isDarkMode ? "#777777" : "#aaaaaa" }, distance: 160, enable: true, opacity: isDarkMode ? 0.3 : 0.4, width: 1, }, move: { direction: "none", enable: true, outModes: { default: "out" }, random: true, speed: 0.8, straight: false, }, number: { density: { enable: true, area: 800 }, value: 35, }, opacity: { value: {min: 0.2, max: 0.6} }, shape: { type: "circle" }, size: { value: { min: 1, max: 2.5 } }, }, detectRetina: true,
            };
            if (document.getElementById("tsparticles-bg")) {
                 tsParticles.load({ id: "tsparticles-bg", options: particlesConfig }).then(container => {
                    console.log("[DOM Ready V4] tsParticles loaded successfully.", container ? container.id : 'no container obj'); 
                 }).catch(error => {
                    console.error("[DOM Ready V4] tsParticles failed to load:", error); 
                 });
            }
            
             // --- Setup Explore Hint Click Listener --- (Moved here) ---
             const exploreHint = document.getElementById('explore-hint');
             if (exploreHint) {
                // Ensure listener isn't added multiple times if DOMContentLoaded somehow fires again
                exploreHint.removeEventListener('click', handleExploreHintClick); 
                exploreHint.addEventListener('click', handleExploreHintClick);
                console.log("[DOM Ready V4] Explore hint click listener added."); // ADDED LOG
             } else {
                 console.warn("[DOM Ready V4] #explore-hint element not found for click listener.");
             }
             
             // Run initial animations (checks welcome screen visibility inside)
             runWelcomeAnimations(); 

             // Expose animation function globally for app.js
             window.runWelcomeAnimations = runWelcomeAnimations;
        });

    </script>
</body>
</html>