<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DirAnalyse Matrix v3.0</title>
    <link rel="icon" href="matrix_icon.png" type="image/png">
    <link rel="stylesheet" href="css/styles.css">
    <!-- Import maps to handle modules directly in browser -->
    <script type="importmap">
    {
      "imports": {
        "fileSystem": "./js/fileSystem.js",
        "uiManager": "./js/uiManager.js",
        "treeView": "./js/treeView.js",
        "statsManager": "./js/statsManager.js",
        "reportGenerator": "./js/reportGenerator.js",
        "combineMode": "./js/combineMode.js",
        "utils": "./js/utils.js",
        "notificationSystem": "./js/notificationSystem.js",
        "themeManager": "./js/themeManager.js",
        "errorHandler": "./js/errorHandler.js"
      }
    }
    </script>
</head>
<body class="theme-retro">
    <div id="notification" class="notification"></div>
    
    <header>
        <h1>DirAnalyse Matrix v3.0</h1>
        <div class="theme-selector">
            <button id="retroTheme" class="theme-button active">Retro</button>
            <button id="modernTheme" class="theme-button">Modern</button>
            <button id="minimalTheme" class="theme-button">Minimal</button>
        </div>
    </header>

    <div id="mainAction">
        <div id="dropZone">
            <div class="drop-content">
                <div class="drop-icon">üìÅ</div>
                <div class="drop-text">DRAG & DROP FOLDER HERE TO INITIATE SCAN</div>
                <div class="drop-alternative">- OR -</div>
                <label for="folderInput" class="folder-select-btn">SELECT FOLDER</label>
                <input type="file" id="folderInput" webkitdirectory directory multiple style="display:none">
            </div>
        </div>
        <div id="loader">ANALYSING SECTOR... STAND BY...</div>
    </div>

    <div id="globalStatsPanel" class="stats-panel" style="display:none;">
        <div class="panel-header">
            <h2>OVERALL STATISTICS</h2>
        </div>
        <div id="selectionSummary" class="selection-summary" style="display:none;"></div>
        <div id="globalStats"></div>
        <div class="file-type-stats">
            <h3>FILE TYPE BREAKDOWN (OF COMMITTED SELECTION)</h3>
            <table id="fileTypeTable">
                <thead>
                    <tr><th>Extension</th><th>Count</th><th>Total Size</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div id="toolsContainer" style="display:none;">
        <button id="selectAllBtn" class="action-button">SELECT ALL</button>
        <button id="deselectAllBtn" class="action-button">DESELECT ALL</button>
        <button id="commitSelectionsBtn" class="action-button">COMMIT SELECTIONS</button>
        <div class="separator"></div>
        <button id="expandAllBtn" class="action-button">EXPAND ALL</button>
        <button id="collapseAllBtn" class="action-button">COLLAPSE ALL</button>
        <div class="separator"></div>
        <button id="viewModeToggleBtn" class="action-button">SWITCH TO COMBINE VIEW</button>
    </div>

    <div class="main-container" style="display:none;">
        <div id="visualOutputContainer">
            <div class="panel-header">
                <h2>VISUAL DIRECTORY TREE</h2>
            </div>
            <div id="treeContainer" class="tree"></div> 
        </div>
        
        <div id="textOutputContainerOuter">
            <div class="panel-header">
                <h2>COMPREHENSIVE TEXT REPORT</h2>
            </div>
            <pre id="textOutput"></pre>
            <div class="button-container">
                <button id="copyReportButton" class="action-button" disabled>COPY REPORT</button>
            </div>
        </div>
        
        <div id="combineModePanel">
            <div class="panel-header">
                <h2>COMMITTED FILES FOR COMBINING</h2>
            </div>
            <div id="selectedFilesContainer">
                <div class="empty-notice">NO FILES IN COMMITTED SELECTION.<br>USE TREE AND 'COMMIT SELECTIONS'.</div>
            </div>
            <div class="button-container">
                <button id="copySelectedBtn" class="action-button" disabled>COPY COMMITTED FILES</button>
            </div>
        </div>
    </div>
    
    <div id="errorReport" class="error-panel">
        <div class="error-header">
            <h3>ERROR REPORT</h3>
            <button id="closeErrorBtn">√ó</button>
        </div>
        <div class="error-content">
            <div class="error-title"></div>
            <div class="error-message"></div>
            <div class="error-details"></div>
            <div class="error-suggestions"></div>
        </div>
    </div>
    
    <div id="filePreview">
        <button id="closePreview">√ó</button>
        <h3 id="filePreviewTitle"></h3>
        <pre id="filePreviewContent"></pre>
    </div>

    <button class="crt-toggle" id="crtToggle">CRT: ON</button>

    <!-- Main script to initialize the application -->
    <script type="module" src="js/main.js"></script>
</body>
</html>